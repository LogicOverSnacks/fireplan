<svg viewBox="0 0 200 100">

  @if (thresholdRect(); as rect) {
    <rect class="threshold" x="0" [attr.y]="rect.y" width="200" [attr.height]="rect.height"></rect>
  }

  <path class="raw-rate" [attr.d]="rawRatePath()" stroke="gray" fill="none"></path>
  <path class="rate" [attr.d]="ratePath()" stroke="red" fill="none"></path>

  <path class="target" [attr.d]="targetPath()" stroke="black" stroke-width=".25" stroke-dasharray="2"></path>

</svg>

<form [formGroup]="form">
  <mat-form-field subscriptSizing="dynamic" floatLabel="always">
    <mat-label>Target</mat-label>
    <input matInput hidden formControlName="target">
    <mat-slider color="primary" min="0" max="1" step="0.00001" (input)="targetSliderChanged($event)">
      <input matSliderThumb [value]="targetSliderValue()">
    </mat-slider>
    <div matTextSuffix>
      <input type="number" step="0.1" min="0" max="100" matInput class="target-ctrl" formControlName="target">
      <span>%</span>
    </div>

    <mat-hint>
      The target withdrawal rate per year as a proportion of the total fund.
    </mat-hint>
    @if (form.controls.target.hasError('max') || form.controls.target.hasError('min')) {
      <mat-error>Value must be between 0 and 100</mat-error>
    }
  </mat-form-field>

  <mat-form-field subscriptSizing="dynamic" floatLabel="always">
    <mat-label>Threshold</mat-label>
    <input matInput hidden formControlName="threshold">
    <mat-slider color="accent" min="0" max="1" step="0.00001" (input)="thresholdSliderChanged($event)">
      <input matSliderThumb [value]="thresholdSliderValue()">
    </mat-slider>
    <div matTextSuffix>
      <input
        type="number"
        matInput
        step="0.1"
        min="0"
        placeholder="∞"
        class="threshold-ctrl"
        formControlName="threshold"
      >
      <span>%</span>
    </div>

    <mat-hint>
      The withdrawal rate will be adjusted when it deviates from the target by more than this threshold.
    </mat-hint>
    @if (form.controls.threshold.hasError('min')) {
      <mat-error>Value must be greater than or equal to 0</mat-error>
    }
  </mat-form-field>

  <mat-form-field subscriptSizing="dynamic" floatLabel="always">
    <mat-label>Correction</mat-label>
    <input matInput hidden formControlName="adjustment">
    <mat-slider color="warn" min="0" max="1" step="0.00001" (input)="adjustmentSliderChanged($event)">
      <input matSliderThumb [value]="adjustmentSliderValue()">
    </mat-slider>
    <div matTextSuffix>
      <input
        type="number"
        matInput
        step="0.1"
        min="0"
        placeholder="∞"
        class="adjustment-ctrl"
        formControlName="adjustment"
      >
      <span>%</span>
    </div>

    <mat-hint>
      The maximum adjustment that can be made to the withdrawal rate per year.
    </mat-hint>
    @if (form.controls.adjustment.hasError('max') || form.controls.adjustment.hasError('min')) {
      <mat-error>Value must be between 0 and 100</mat-error>
    }
  </mat-form-field>
</form>
